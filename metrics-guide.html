<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sapinover LLC | Metrics Explanation Guide</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Source+Serif+4:wght@400;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0a;
            --card: #141418;
            --card-border: #1e1e24;
            --text: #f0f0f2;
            --text-muted: #8a8a96;
            --amber: #f5a623;
            --amber-dim: rgba(245, 166, 35, 0.15);
            --green: #4caf50;
            --green-dim: rgba(76, 175, 80, 0.12);
            --red: #ef5350;
            --red-dim: rgba(239, 83, 80, 0.12);
            --blue: #42a5f5;
            --blue-dim: rgba(66, 165, 245, 0.12);
            --purple: #ab47bc;
            --purple-dim: rgba(171, 71, 188, 0.12);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.7;
            padding: 0;
        }

        /* Header */
        .header {
            background: linear-gradient(180deg, #111115 0%, var(--bg) 100%);
            border-bottom: 1px solid var(--card-border);
            padding: 40px 0 32px;
            text-align: center;
        }
        .header img { height: 32px; margin-bottom: 12px; }
        .header h1 {
            font-family: 'Source Serif 4', serif;
            font-size: 2.2rem;
            font-weight: 600;
            letter-spacing: -0.02em;
            margin-bottom: 4px;
        }
        .header h1 span { color: var(--amber); }
        .header .subtitle {
            font-size: 0.85rem;
            color: var(--text-muted);
            letter-spacing: 0.12em;
            text-transform: uppercase;
        }
        .header .back-link {
            display: inline-block;
            margin-top: 16px;
            color: var(--amber);
            text-decoration: none;
            font-size: 0.85rem;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        .header .back-link:hover { opacity: 1; }

        /* Layout */
        .container { max-width: 960px; margin: 0 auto; padding: 40px 24px 80px; }

        /* Table of Contents */
        .toc {
            background: var(--card);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 28px 32px;
            margin-bottom: 48px;
        }
        .toc h2 {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            margin-bottom: 16px;
        }
        .toc-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px 32px;
        }
        .toc a {
            color: var(--text);
            text-decoration: none;
            font-size: 0.95rem;
            padding: 4px 0;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.2s;
        }
        .toc a:hover { color: var(--amber); }
        .toc .num {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--amber);
            min-width: 24px;
        }

        /* Section */
        .section { margin-bottom: 56px; }
        .section-anchor { display: block; position: relative; top: -80px; visibility: hidden; }

        .section h2 {
            font-family: 'Source Serif 4', serif;
            font-size: 1.6rem;
            font-weight: 600;
            margin-bottom: 8px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--amber);
            display: inline-block;
        }
        .section h3 {
            font-size: 1.15rem;
            font-weight: 500;
            margin: 28px 0 12px;
            color: var(--amber);
        }
        .section p { color: var(--text-muted); margin-bottom: 16px; font-size: 0.95rem; }
        .section p strong { color: var(--text); }

        /* Formula boxes */
        .formula-box {
            background: var(--card);
            border: 1px solid var(--card-border);
            border-left: 3px solid var(--amber);
            border-radius: 8px;
            padding: 20px 24px;
            margin: 20px 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 2;
        }
        .formula-box .label {
            font-family: 'Outfit', sans-serif;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        .formula-box .formula { color: var(--amber); font-size: 1rem; }
        .formula-box .note {
            font-family: 'Outfit', sans-serif;
            font-size: 0.82rem;
            color: var(--text-muted);
            margin-top: 8px;
            font-style: italic;
        }

        /* Example cards */
        .example {
            background: var(--card);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 24px;
            margin: 20px 0;
            overflow-x: auto;
        }
        .example .tag {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            margin-bottom: 12px;
        }
        .tag-up { background: var(--green-dim); color: var(--green); }
        .tag-down { background: var(--red-dim); color: var(--red); }
        .tag-consistent { background: var(--green-dim); color: var(--green); }
        .tag-inconsistent { background: var(--red-dim); color: var(--red); }
        .tag-info { background: var(--blue-dim); color: var(--blue); }
        .tag-etf { background: var(--purple-dim); color: var(--purple); }

        .example h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .example .ticker { color: var(--amber); }
        .example .date { color: var(--text-muted); font-size: 0.85rem; margin-bottom: 16px; }

        /* Price flow diagrams */
        .price-flow {
            display: flex;
            align-items: center;
            gap: 0;
            margin: 16px 0;
            flex-wrap: wrap;
        }
        .price-node {
            background: #1a1a20;
            border: 1px solid var(--card-border);
            border-radius: 8px;
            padding: 10px 16px;
            text-align: center;
            min-width: 120px;
        }
        .price-node .label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            margin-bottom: 4px;
        }
        .price-node .value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            font-weight: 500;
        }
        .price-arrow {
            color: var(--text-muted);
            font-size: 1.2rem;
            padding: 0 8px;
            flex-shrink: 0;
        }
        .price-arrow.up { color: var(--green); }
        .price-arrow.down { color: var(--red); }

        /* Calculation steps */
        .calc-steps {
            margin: 16px 0;
            padding: 0;
            list-style: none;
        }
        .calc-steps li {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.88rem;
            padding: 6px 0;
            color: var(--text-muted);
            border-bottom: 1px solid rgba(255,255,255,0.04);
        }
        .calc-steps li:last-child { border-bottom: none; }
        .calc-steps .result {
            color: var(--text);
            font-weight: 500;
        }
        .calc-steps .highlight-green { color: var(--green); }
        .calc-steps .highlight-red { color: var(--red); }
        .calc-steps .highlight-amber { color: var(--amber); }

        /* Info callouts */
        .callout {
            border-radius: 8px;
            padding: 16px 20px;
            margin: 20px 0;
            font-size: 0.9rem;
        }
        .callout-insight {
            background: var(--amber-dim);
            border-left: 3px solid var(--amber);
        }
        .callout-insight strong { color: var(--amber); }
        .callout-warning {
            background: var(--red-dim);
            border-left: 3px solid var(--red);
        }
        .callout-warning strong { color: var(--red); }
        .callout-info {
            background: var(--blue-dim);
            border-left: 3px solid var(--blue);
        }
        .callout-info strong { color: var(--blue); }

        /* Stats grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        .stat-card {
            background: var(--card);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }
        .stat-card .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--amber);
        }
        .stat-card .stat-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Diagram: visual timeline */
        .timeline-diagram {
            background: var(--card);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 28px;
            margin: 24px 0;
            position: relative;
            overflow: hidden;
        }
        .timeline-bar {
            height: 4px;
            background: var(--card-border);
            border-radius: 2px;
            margin: 32px 0 24px;
            position: relative;
        }
        .timeline-bar::before {
            content: '';
            position: absolute;
            left: 15%;
            right: 15%;
            top: 0;
            height: 100%;
            background: var(--amber);
            border-radius: 2px;
        }
        .timeline-labels {
            display: flex;
            justify-content: space-between;
            position: relative;
        }
        .timeline-label {
            text-align: center;
            font-size: 0.8rem;
        }
        .timeline-label .time {
            font-family: 'JetBrains Mono', monospace;
            color: var(--text);
            font-weight: 500;
        }
        .timeline-label .desc {
            color: var(--text-muted);
            font-size: 0.72rem;
        }
        .timeline-label.active .time { color: var(--amber); }

        /* Summary table */
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            font-size: 0.88rem;
        }
        .summary-table th {
            text-align: left;
            padding: 10px 16px;
            background: #111115;
            color: var(--text-muted);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            border-bottom: 1px solid var(--card-border);
        }
        .summary-table td {
            padding: 10px 16px;
            border-bottom: 1px solid rgba(255,255,255,0.04);
            color: var(--text-muted);
        }
        .summary-table td:first-child { color: var(--text); font-weight: 500; }
        .summary-table .val-pos { color: var(--green); font-family: 'JetBrains Mono', monospace; }
        .summary-table .val-neg { color: var(--red); font-family: 'JetBrains Mono', monospace; }
        .summary-table .val-neutral { color: var(--text); font-family: 'JetBrains Mono', monospace; }

        /* Responsive */
        @media (max-width: 700px) {
            .toc-grid { grid-template-columns: 1fr; }
            .price-flow { flex-direction: column; align-items: flex-start; }
            .price-arrow { transform: rotate(90deg); padding: 4px 0; }
            .stats-grid { grid-template-columns: 1fr 1fr; }
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 40px 24px;
            border-top: 1px solid var(--card-border);
            color: var(--text-muted);
            font-size: 0.8rem;
            line-height: 1.8;
        }
        .footer a { color: var(--amber); text-decoration: none; }
    </style>
</head>
<body>

<div class="header">
    <div style="font-family: 'Outfit', sans-serif; font-weight: 700; font-size: 1.1rem; letter-spacing: 0.25em; text-transform: uppercase; color: var(--text-muted); margin-bottom: 8px;">SAPINOVER</div>
    <h1>Overnight ATS <span>Metrics Guide</span></h1>
    <div class="subtitle">How We Measure Overnight Execution Quality</div>
    <a href="index.html" class="back-link">&larr; Back to Dashboard</a>
</div>

<div class="container">

    <!-- TOC -->
    <div class="toc">
        <h2>Contents</h2>
        <div class="toc-grid">
            <a href="#overview"><span class="num">01</span> The Overnight Session</a>
            <a href="#prior-close"><span class="num">02</span> Prior Close</a>
            <a href="#vwap"><span class="num">03</span> Overnight VWAP</a>
            <a href="#next-open"><span class="num">04</span> Next Day Open</a>
            <a href="#timing-diff"><span class="num">05</span> Timing Differential</a>
            <a href="#ref-gap"><span class="num">06</span> Reference Gap</a>
            <a href="#total-gap"><span class="num">07</span> Total Overnight Gap</a>
            <a href="#direction"><span class="num">08</span> Gap Direction</a>
            <a href="#consistency"><span class="num">09</span> Directional Consistency</a>
            <a href="#captured-alpha"><span class="num">10</span> Captured Alpha</a>
            <a href="#winsorization"><span class="num">11</span> Winsorization</a>
            <a href="#examples"><span class="num">12</span> Worked Examples</a>
        </div>
    </div>

    <!-- 1. Overview -->
    <div class="section">
        <span class="section-anchor" id="overview"></span>
        <h2>01. The Overnight Session</h2>
        <p>Virtually all equity returns occur between market close (4:00 PM ET) and the next morning's open (9:30 AM ET), not during regular trading hours. This is the <strong>overnight return anomaly</strong>, documented in academic literature.</p>
        <p>Alternative Trading Systems (ATS) operate during this window, allowing institutional participants to trade equities when exchanges are closed. Our research analyzes execution quality in these overnight sessions.</p>

        <div class="timeline-diagram">
            <div class="timeline-labels" style="margin-bottom: 8px;">
                <div class="timeline-label">
                    <div class="time">4:00 PM</div>
                    <div class="desc">Market Close</div>
                    <div class="desc" style="color: var(--amber);">Prior Close</div>
                </div>
                <div class="timeline-label active">
                    <div class="time">8 PM - 4 AM</div>
                    <div class="desc">Overnight Session</div>
                    <div class="desc" style="color: var(--amber);">ATS VWAP</div>
                </div>
                <div class="timeline-label">
                    <div class="time">9:30 AM</div>
                    <div class="desc">Market Open</div>
                    <div class="desc" style="color: var(--amber);">Next Open</div>
                </div>
            </div>
            <div class="timeline-bar"></div>
            <p style="text-align:center; font-size: 0.82rem; color: var(--text-muted); margin: 0;">
                Three reference prices define every overnight observation. The relationships between them determine all metrics.
            </p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">60,955</div>
                <div class="stat-label">Observations</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">79</div>
                <div class="stat-label">Trading Days</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">$194.2B</div>
                <div class="stat-label">Total Notional</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">3,272</div>
                <div class="stat-label">Unique Symbols</div>
            </div>
        </div>
    </div>

    <!-- 2. Prior Close -->
    <div class="section">
        <span class="section-anchor" id="prior-close"></span>
        <h2>02. Prior Close</h2>
        <p>The <strong>Prior Close</strong> is the last regular-session closing price before the overnight session begins. It serves as the baseline reference for all basis point calculations.</p>
        <p>We source this from Yahoo Finance market data. All percentage and basis point calculations use Prior Close as the denominator to normalize across different price levels.</p>

        <div class="callout callout-info">
            <strong>Why Prior Close as denominator?</strong> A $1 move on a $20 stock (50 bps) is not equivalent to a $1 move on a $500 stock (2 bps). Normalizing by Prior Close lets us compare execution quality across all price levels on the same scale.
        </div>
    </div>

    <!-- 3. VWAP -->
    <div class="section">
        <span class="section-anchor" id="vwap"></span>
        <h2>03. Overnight VWAP</h2>
        <p>The <strong>Volume-Weighted Average Price (VWAP)</strong> is the average price at which shares traded during the overnight ATS session, weighted by volume at each price level.</p>
        <p>VWAP represents the <strong>actual execution price</strong> that participants received. It is the single most important price for measuring execution quality because it reflects where real money changed hands.</p>

        <div class="formula-box">
            <div class="label">Definition</div>
            <div class="formula">VWAP = Sum(Price_i x Volume_i) / Sum(Volume_i)</div>
            <div class="note">Computed across all trades in the overnight session for each symbol</div>
        </div>

        <div class="callout callout-insight">
            <strong>Key insight:</strong> VWAP is not a theoretical price. It is the dollar-weighted average of every executed trade. If 80% of volume traded at $100 and 20% at $102, the VWAP is $100.40, not $101.
        </div>
    </div>

    <!-- 4. Next Open -->
    <div class="section">
        <span class="section-anchor" id="next-open"></span>
        <h2>04. Next Day Open</h2>
        <p>The <strong>Next Day Open</strong> is the opening price when the regular session begins at 9:30 AM ET. This is the first price that all market participants can access.</p>
        <p>The relationship between the overnight VWAP and Next Day Open determines whether overnight participants executed at a better or worse price than what was available at the open. This is the core of execution timing analysis.</p>
    </div>

    <!-- 5. Timing Differential -->
    <div class="section">
        <span class="section-anchor" id="timing-diff"></span>
        <h2>05. Timing Differential (bps)</h2>
        <p>The <strong>Timing Differential</strong> measures the difference between where you executed overnight (VWAP) and where the stock opened the next morning, expressed in basis points relative to Prior Close.</p>

        <div class="formula-box">
            <div class="label">Formula</div>
            <div class="formula">Timing Differential = (Next_Open - VWAP) / Prior_Close x 10,000</div>
            <div class="note">Result is in basis points (1 bps = 0.01%)</div>
        </div>

        <h3>What the sign tells you</h3>
        <p><strong>Positive value:</strong> The stock opened higher than where it was purchased overnight. If you bought at VWAP and the stock opens above that price, the gap represents potential unrealized gain at the open.</p>
        <p><strong>Negative value:</strong> The stock opened lower than the overnight VWAP. If you bought at VWAP and the stock opens below, the gap represents potential unrealized loss at the open.</p>

        <div class="callout callout-warning">
            <strong>Important nuance:</strong> The sign alone does not determine good or bad execution. Direction matters. Buying overnight with a negative Timing Differential can be favorable if the stock was gapping down and you bought at a price between the prior close and the lower open. See <a href="#consistency" style="color: var(--amber);">Directional Consistency</a> for the full picture.
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" style="color: var(--text);">-39.2</div>
                <div class="stat-label">Mean (bps)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" style="color: var(--text);">-20.1</div>
                <div class="stat-label">Median (bps)</div>
            </div>
        </div>
    </div>

    <!-- 6. Reference Gap -->
    <div class="section">
        <span class="section-anchor" id="ref-gap"></span>
        <h2>06. Reference Gap (bps)</h2>
        <p>The <strong>Reference Gap</strong> measures the total overnight price movement from the prior close to the overnight VWAP. It represents how much the price moved before or during the overnight session, independent of execution.</p>

        <div class="formula-box">
            <div class="label">Formula</div>
            <div class="formula">Reference Gap = (VWAP - Prior_Close) / Prior_Close x 10,000</div>
            <div class="note">Measures the "gap" from close to overnight execution level</div>
        </div>

        <p>A large positive Reference Gap means the overnight VWAP was well above the prior close. Participants paid more than the closing price. A negative Reference Gap means overnight trading occurred below the prior close.</p>
    </div>

    <!-- 7. Total Overnight Gap -->
    <div class="section">
        <span class="section-anchor" id="total-gap"></span>
        <h2>07. Total Overnight Gap (bps)</h2>
        <p>The <strong>Total Overnight Gap</strong> captures the full close-to-open price movement. It is the sum of the Reference Gap and the Timing Differential.</p>

        <div class="formula-box">
            <div class="label">Formula</div>
            <div class="formula">Total Gap = (Next_Open - Prior_Close) / Prior_Close x 10,000</div>
            <div class="note">Equivalent to: Reference Gap + Timing Differential</div>
        </div>

        <div class="callout callout-info">
            <strong>Decomposition:</strong> The Total Overnight Gap breaks into two components. The Reference Gap shows how much moved before/during the overnight session. The Timing Differential shows how much additional movement occurred between the VWAP and the open. Together they account for the entire close-to-open move.
        </div>

        <div class="formula-box">
            <div class="label">Relationship</div>
            <div class="formula">Total Gap = Reference Gap + Timing Differential</div>
            <div class="note">
                Prior Close &rarr; [Reference Gap] &rarr; VWAP &rarr; [Timing Diff] &rarr; Next Open
            </div>
        </div>
    </div>

    <!-- 8. Gap Direction -->
    <div class="section">
        <span class="section-anchor" id="direction"></span>
        <h2>08. Gap Direction</h2>
        <p><strong>Gap Direction</strong> classifies whether the stock gapped up or down from the prior close to the next open.</p>

        <div class="formula-box">
            <div class="label">Logic</div>
            <div class="formula">
                If Next_Open > Prior_Close &rarr; <span style="color: var(--green);">UP</span><br>
                If Next_Open &le; Prior_Close &rarr; <span style="color: var(--red);">DOWN</span>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" style="color: var(--green);">53.5%</div>
                <div class="stat-label">UP Gaps</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" style="color: var(--red);">46.5%</div>
                <div class="stat-label">DOWN Gaps</div>
            </div>
        </div>
    </div>

    <!-- 9. Directional Consistency -->
    <div class="section">
        <span class="section-anchor" id="consistency"></span>
        <h2>09. Directional Consistency</h2>
        <p><strong>Directional Consistency</strong> (also called Price Continuity) answers the key question: <em>did the overnight VWAP land between the prior close and the next open?</em></p>
        <p>When the VWAP falls between those two prices, the overnight execution was aligned with the direction of the overnight move. The participant bought (or sold) at a price that was better than the open.</p>

        <div class="formula-box">
            <div class="label">Logic</div>
            <div class="formula">
                If gap is <span style="color: var(--green);">UP</span> and Timing Diff > 0 &rarr; <span style="color: var(--green);">Consistent</span><br>
                If gap is <span style="color: var(--red);">DOWN</span> and Timing Diff < 0 &rarr; <span style="color: var(--green);">Consistent</span><br>
                Otherwise &rarr; <span style="color: var(--red);">Inconsistent</span>
            </div>
        </div>

        <h3>Visual intuition</h3>

        <div class="example">
            <span class="tag tag-consistent">Consistent (UP gap)</span>
            <p style="color: var(--text); font-size: 0.9rem; margin-bottom: 12px;">Stock gaps up. VWAP is between close and open. Bought below where it opened.</p>
            <div class="price-flow">
                <div class="price-node">
                    <div class="label">Prior Close</div>
                    <div class="value">$100.00</div>
                </div>
                <div class="price-arrow up">&rarr;</div>
                <div class="price-node" style="border-color: var(--amber);">
                    <div class="label" style="color: var(--amber);">VWAP</div>
                    <div class="value" style="color: var(--amber);">$101.50</div>
                </div>
                <div class="price-arrow up">&rarr;</div>
                <div class="price-node">
                    <div class="label">Next Open</div>
                    <div class="value" style="color: var(--green);">$103.00</div>
                </div>
            </div>
            <p style="font-size: 0.85rem;">Timing Diff = +150 bps. The open was above VWAP. Execution was favorable.</p>
        </div>

        <div class="example">
            <span class="tag tag-consistent">Consistent (DOWN gap)</span>
            <p style="color: var(--text); font-size: 0.9rem; margin-bottom: 12px;">Stock gaps down. VWAP is between close and open. Sold above where it opened.</p>
            <div class="price-flow">
                <div class="price-node">
                    <div class="label">Prior Close</div>
                    <div class="value">$100.00</div>
                </div>
                <div class="price-arrow down">&rarr;</div>
                <div class="price-node" style="border-color: var(--amber);">
                    <div class="label" style="color: var(--amber);">VWAP</div>
                    <div class="value" style="color: var(--amber);">$98.50</div>
                </div>
                <div class="price-arrow down">&rarr;</div>
                <div class="price-node">
                    <div class="label">Next Open</div>
                    <div class="value" style="color: var(--red);">$97.00</div>
                </div>
            </div>
            <p style="font-size: 0.85rem;">Timing Diff = -150 bps. The open was below VWAP. If you sold overnight, you sold at a higher price than the open.</p>
        </div>

        <div class="example">
            <span class="tag tag-inconsistent">Inconsistent</span>
            <p style="color: var(--text); font-size: 0.9rem; margin-bottom: 12px;">Stock gaps down, but VWAP is above both close and open. Execution was not aligned with direction.</p>
            <div class="price-flow">
                <div class="price-node">
                    <div class="label">Prior Close</div>
                    <div class="value">$100.00</div>
                </div>
                <div class="price-arrow" style="color: var(--red);">&rarr;</div>
                <div class="price-node" style="border-color: var(--red);">
                    <div class="label" style="color: var(--red);">VWAP</div>
                    <div class="value" style="color: var(--red);">$101.50</div>
                </div>
                <div class="price-arrow down">&rarr;</div>
                <div class="price-node">
                    <div class="label">Next Open</div>
                    <div class="value" style="color: var(--red);">$98.00</div>
                </div>
            </div>
            <p style="font-size: 0.85rem;">Timing Diff = -350 bps, but gap was DOWN. Overnight buyers paid above both the close and the open.</p>
        </div>

        <div class="stat-card" style="max-width: 260px; margin: 20px 0;">
            <div class="stat-value">68.8%</div>
            <div class="stat-label">Directional Consistency Rate</div>
        </div>
        <p>Across our 79-day sample, 68.8% of overnight observations show directional consistency, meaning the VWAP landed between the prior close and next open nearly 7 out of 10 times.</p>
    </div>

    <!-- 10. Captured Alpha -->
    <div class="section">
        <span class="section-anchor" id="captured-alpha"></span>
        <h2>10. Captured Alpha</h2>
        <p><strong>Captured Alpha</strong> in the dashboard is currently equivalent to the Timing Differential. It measures the basis point difference between the overnight VWAP and the next day open, normalized by prior close.</p>

        <div class="formula-box">
            <div class="label">Formula (same as Timing Differential)</div>
            <div class="formula">Captured Alpha = (Next_Open - VWAP) / Prior_Close x 10,000</div>
            <div class="note">Used in clustering, heatmaps, and cross-metric correlation analysis</div>
        </div>

        <p>The dashboard provides both a <strong>raw</strong> and <strong>winsorized</strong> version. The winsorized version clips extreme values to the 5th and 95th percentiles, preventing outliers from distorting visualizations and statistical summaries.</p>

        <div class="callout callout-insight">
            <strong>Why a separate field?</strong> In cluster analysis and heatmap correlations, Captured Alpha serves as the primary execution quality metric. Having it as a distinct field allows the dashboard to toggle between raw Timing Differential (for granular analysis) and Captured Alpha (for statistical patterns) independently.
        </div>
    </div>

    <!-- 11. Winsorization -->
    <div class="section">
        <span class="section-anchor" id="winsorization"></span>
        <h2>11. Winsorization</h2>
        <p><strong>Winsorization</strong> is a statistical technique that clips extreme values to specified percentile bounds. In our dashboard, the "Winsorized" toggle replaces any values below the 5th percentile or above the 95th percentile with those boundary values.</p>

        <div class="formula-box">
            <div class="label">Logic</div>
            <div class="formula">
                If value &lt; P5 &rarr; set to P5<br>
                If value &gt; P95 &rarr; set to P95<br>
                Otherwise &rarr; keep original
            </div>
            <div class="note">Applied independently to Timing Differential, Reference Gap, and Captured Alpha</div>
        </div>

        <p>This is important for overnight data because single pricing errors or corporate actions can create extreme outliers. For example, a stock split that is not yet reflected in reference prices could show thousands of basis points. Winsorization prevents these from dominating averages and charts while keeping the raw data available.</p>

        <div class="callout callout-warning">
            <strong>Data quality note:</strong> Observations with absolute Timing Differential exceeding 1,000 bps are flagged as outliers. These typically result from pricing discrepancies, corporate actions, or ticker changes rather than genuine market moves.
        </div>
    </div>

    <!-- 12. Worked Examples -->
    <div class="section">
        <span class="section-anchor" id="examples"></span>
        <h2>12. Worked Examples from Our Data</h2>
        <p>The following examples use real observations from the 79-day dataset (Sep 2, 2025 to Feb 24, 2026). All prices and calculations are actual data.</p>

        <!-- Example A: AAPL UP consistent -->
        <div class="example">
            <span class="tag tag-up">UP Gap</span>
            <span class="tag tag-consistent">Consistent</span>
            <h4><span class="ticker">AAPL</span></h4>
            <div class="date">February 2, 2026 | Notional: $64.0M | 248,974 shares</div>

            <div class="price-flow">
                <div class="price-node">
                    <div class="label">Prior Close</div>
                    <div class="value">$259.24</div>
                </div>
                <div class="price-arrow up">&rarr;</div>
                <div class="price-node" style="border-color: var(--amber);">
                    <div class="label" style="color: var(--amber);">VWAP</div>
                    <div class="value" style="color: var(--amber);">$256.97</div>
                </div>
                <div class="price-arrow up">&rarr;</div>
                <div class="price-node">
                    <div class="label">Next Open</div>
                    <div class="value" style="color: var(--green);">$259.79</div>
                </div>
            </div>

            <ul class="calc-steps">
                <li><span class="highlight-amber">Reference Gap</span> = ($256.97 - $259.24) / $259.24 x 10,000 = <span class="highlight-red">-87.4 bps</span></li>
                <li><span class="highlight-amber">Timing Differential</span> = ($259.79 - $256.97) / $259.24 x 10,000 = <span class="highlight-green">+108.6 bps</span></li>
                <li><span class="highlight-amber">Total Gap</span> = -87.4 + 108.6 = <span class="result">+21.2 bps</span></li>
                <li><span class="highlight-amber">Gap Direction</span> = $259.79 > $259.24 &rarr; <span class="highlight-green">UP</span></li>
                <li><span class="highlight-amber">Consistency</span> = UP gap, TD > 0 &rarr; <span class="highlight-green">Consistent</span></li>
            </ul>

            <div class="callout callout-insight" style="margin-top: 16px;">
                <strong>Interpretation:</strong> AAPL traded overnight at $256.97, below its prior close of $259.24. But the stock opened higher at $259.79. The VWAP landed between close and open (consistent). Overnight buyers purchased at a discount to both the prior close and the next open.
            </div>
        </div>

        <!-- Example B: TSLA DOWN consistent -->
        <div class="example">
            <span class="tag tag-down">DOWN Gap</span>
            <span class="tag tag-consistent">Consistent</span>
            <h4><span class="ticker">TSLA</span></h4>
            <div class="date">December 17, 2025 | Notional: $565.0M | 1,149,291 shares</div>

            <div class="price-flow">
                <div class="price-node">
                    <div class="label">Prior Close</div>
                    <div class="value">$489.88</div>
                </div>
                <div class="price-arrow down">&rarr;</div>
                <div class="price-node" style="border-color: var(--amber);">
                    <div class="label" style="color: var(--amber);">VWAP</div>
                    <div class="value" style="color: var(--amber);">$491.61</div>
                </div>
                <div class="price-arrow down">&rarr;</div>
                <div class="price-node">
                    <div class="label">Next Open</div>
                    <div class="value" style="color: var(--red);">$488.22</div>
                </div>
            </div>

            <ul class="calc-steps">
                <li><span class="highlight-amber">Reference Gap</span> = ($491.61 - $489.88) / $489.88 x 10,000 = <span class="highlight-green">+35.4 bps</span></li>
                <li><span class="highlight-amber">Timing Differential</span> = ($488.22 - $491.61) / $489.88 x 10,000 = <span class="highlight-red">-69.3 bps</span></li>
                <li><span class="highlight-amber">Total Gap</span> = 35.4 + (-69.3) = <span class="result">-33.9 bps</span></li>
                <li><span class="highlight-amber">Gap Direction</span> = $488.22 < $489.88 &rarr; <span class="highlight-red">DOWN</span></li>
                <li><span class="highlight-amber">Consistency</span> = DOWN gap, TD < 0 &rarr; <span class="highlight-green">Consistent</span></li>
            </ul>

            <div class="callout callout-insight" style="margin-top: 16px;">
                <strong>Interpretation:</strong> TSLA gapped down from $489.88 to a $488.22 open. The overnight VWAP of $491.61 was above the prior close, meaning the VWAP was between the open and close when viewed directionally. The negative Timing Differential is actually favorable in a down-gap scenario: if participants sold overnight, they sold at a higher price ($491.61) than the next open ($488.22).
            </div>
        </div>

        <!-- Example C: Inconsistent MU -->
        <div class="example">
            <span class="tag tag-down">DOWN Gap</span>
            <span class="tag tag-inconsistent">Inconsistent</span>
            <h4><span class="ticker">MU</span> (Micron Technology)</h4>
            <div class="date">February 2, 2026 | Notional: $627.3M | 1,552,756 shares</div>

            <div class="price-flow">
                <div class="price-node">
                    <div class="label">Prior Close</div>
                    <div class="value">$414.88</div>
                </div>
                <div class="price-arrow" style="color: var(--red);">&rarr;</div>
                <div class="price-node" style="border-color: var(--red);">
                    <div class="label" style="color: var(--red);">VWAP</div>
                    <div class="value" style="color: var(--red);">$404.02</div>
                </div>
                <div class="price-arrow up">&rarr;</div>
                <div class="price-node">
                    <div class="label">Next Open</div>
                    <div class="value">$412.18</div>
                </div>
            </div>

            <ul class="calc-steps">
                <li><span class="highlight-amber">Reference Gap</span> = ($404.02 - $414.88) / $414.88 x 10,000 = <span class="highlight-red">-261.8 bps</span></li>
                <li><span class="highlight-amber">Timing Differential</span> = ($412.18 - $404.02) / $414.88 x 10,000 = <span class="highlight-green">+196.7 bps</span></li>
                <li><span class="highlight-amber">Total Gap</span> = -261.8 + 196.7 = <span class="result">-65.1 bps</span></li>
                <li><span class="highlight-amber">Gap Direction</span> = $412.18 < $414.88 &rarr; <span class="highlight-red">DOWN</span></li>
                <li><span class="highlight-amber">Consistency</span> = DOWN gap, but TD > 0 &rarr; <span class="highlight-red">Inconsistent</span></li>
            </ul>

            <div class="callout callout-warning" style="margin-top: 16px;">
                <strong>Interpretation:</strong> MU gapped down overall ($414.88 to $412.18), but the overnight VWAP of $404.02 was well below both the close and the open. Overnight buyers purchased at the session low, and the stock bounced back toward the close by the open. The VWAP did not fall between close and open; it overshot to the downside. The positive Timing Differential here reflects the bounce, not favorable execution. This is directionally inconsistent.
            </div>
        </div>

        <!-- Example D: SPY ETF -->
        <div class="example">
            <span class="tag tag-etf">ETF</span>
            <span class="tag tag-up">UP Gap</span>
            <span class="tag tag-consistent">Consistent</span>
            <h4><span class="ticker">SPY</span> (S&P 500 ETF)</h4>
            <div class="date">February 6, 2026 | Notional: $109.5M | 161,910 shares</div>

            <div class="price-flow">
                <div class="price-node">
                    <div class="label">Prior Close</div>
                    <div class="value">$677.62</div>
                </div>
                <div class="price-arrow up">&rarr;</div>
                <div class="price-node" style="border-color: var(--amber);">
                    <div class="label" style="color: var(--amber);">VWAP</div>
                    <div class="value" style="color: var(--amber);">$676.15</div>
                </div>
                <div class="price-arrow up">&rarr;</div>
                <div class="price-node">
                    <div class="label">Next Open</div>
                    <div class="value" style="color: var(--green);">$681.46</div>
                </div>
            </div>

            <ul class="calc-steps">
                <li><span class="highlight-amber">Reference Gap</span> = ($676.15 - $677.62) / $677.62 x 10,000 = <span class="highlight-red">-21.7 bps</span></li>
                <li><span class="highlight-amber">Timing Differential</span> = ($681.46 - $676.15) / $677.62 x 10,000 = <span class="highlight-green">+78.3 bps</span></li>
                <li><span class="highlight-amber">Total Gap</span> = -21.7 + 78.3 = <span class="result">+56.7 bps</span></li>
                <li><span class="highlight-amber">Gap Direction</span> = $681.46 > $677.62 &rarr; <span class="highlight-green">UP</span></li>
                <li><span class="highlight-amber">Consistency</span> = UP gap, TD > 0 &rarr; <span class="highlight-green">Consistent</span></li>
            </ul>

            <div class="callout callout-info" style="margin-top: 16px;">
                <strong>ETF note:</strong> SPY is the most liquid ETF in overnight ATS trading. Its tight spreads and high notional make it a benchmark for overnight execution quality. This observation shows the VWAP at a slight discount to the prior close, with the stock opening higher, resulting in +78.3 bps of favorable timing.
            </div>
        </div>

    </div>

    <!-- Metric Summary Table -->
    <div class="section">
        <h2 style="border-bottom-color: var(--blue);">Quick Reference</h2>
        <table class="summary-table">
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Formula</th>
                    <th>Measures</th>
                    <th>Dataset Median</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Timing Differential</td>
                    <td style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;">(Open - VWAP) / Close</td>
                    <td>VWAP to open gap</td>
                    <td class="val-neg">-20.1 bps</td>
                </tr>
                <tr>
                    <td>Reference Gap</td>
                    <td style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;">(VWAP - Close) / Close</td>
                    <td>Close to VWAP gap</td>
                    <td class="val-neutral">varies</td>
                </tr>
                <tr>
                    <td>Total Overnight Gap</td>
                    <td style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;">(Open - Close) / Close</td>
                    <td>Full close-to-open</td>
                    <td class="val-neutral">varies</td>
                </tr>
                <tr>
                    <td>Captured Alpha</td>
                    <td style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;">Same as Timing Diff</td>
                    <td>Execution quality signal</td>
                    <td class="val-neg">-20.1 bps</td>
                </tr>
                <tr>
                    <td>Gap Direction</td>
                    <td style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;">Open vs Close</td>
                    <td>Overnight direction</td>
                    <td class="val-neutral">53.5% UP</td>
                </tr>
                <tr>
                    <td>Dir. Consistency</td>
                    <td style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;">Direction + TD sign</td>
                    <td>VWAP between C &amp; O</td>
                    <td class="val-pos">68.8%</td>
                </tr>
            </tbody>
        </table>
    </div>

</div>

<div class="footer">
    <p>This analysis constitutes independent research on market microstructure
    and is not intended as investment advice. Past performance does not guarantee
    future results. All statistics are observational and based on historical data
    from 2025-09-02 to 2026-02-24. Sapinover LLC is retained by BlueOcean ATS
    on a flat monthly fee for research services and does not receive
    transaction-based compensation. No investment recommendations are made herein.</p>
    <p style="margin-top: 12px;"><a href="index.html">Sapinover LLC</a> &middot; Market Microstructure Research &middot; 2026</p>
</div>

<!-- Login Overlay -->
<div id="loginOverlay" style="
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #0a0a0a; z-index: 9999;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Outfit', sans-serif;
">
    <div style="text-align: center; max-width: 400px; padding: 40px;">
        <div style="font-weight: 700; font-size: 1.1rem; letter-spacing: 0.25em; text-transform: uppercase; color: #8a8a96; margin-bottom: 8px;">SAPINOVER</div>
        <h2 style="font-family: 'Source Serif 4', serif; font-size: 1.6rem; color: #f0f0f2; margin-bottom: 6px;">
            Metrics Guide
        </h2>
        <p style="color: #8a8a96; font-size: 0.85rem; letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 32px;">
            Authorized Access Only
        </p>
        <form id="loginForm" onsubmit="handleLogin(event)" style="display: flex; flex-direction: column; gap: 12px;">
            <input type="password" id="passwordInput" placeholder="Enter password"
                autocomplete="current-password"
                style="
                    padding: 12px 16px; border-radius: 8px;
                    border: 1px solid #1e1e24; background: #141418;
                    color: #f0f0f2; font-size: 1rem;
                    font-family: 'JetBrains Mono', monospace;
                    outline: none; text-align: center;
                "
                onfocus="this.style.borderColor='#f5a623'" onblur="this.style.borderColor='#1e1e24'"
            >
            <button type="submit" style="
                padding: 12px 24px; border-radius: 8px; border: none;
                background: #f5a623; color: #0a0a0a;
                font-size: 0.95rem; font-weight: 600;
                cursor: pointer; transition: opacity 0.2s;
            " onmouseover="this.style.opacity='0.85'" onmouseout="this.style.opacity='1'">
                View Guide
            </button>
        </form>
        <p id="loginError" style="color: #ef5350; font-size: 0.85rem; margin-top: 12px; display: none;">
            Invalid password. Please try again.
        </p>
    </div>
</div>

<script>
// SHA-256 hash of the password for comparison
const PASS_HASH = 'a0688e2211817fe9994b8b083fd8adfcba5c5e8acae2d2e5e7a660ed174513ee';

async function sha256(str) {
    const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(str));
    return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, '0')).join('');
}

async function handleLogin(e) {
    if (e) e.preventDefault();
    const pw = document.getElementById('passwordInput').value;
    if (!pw) return;
    const hash = await sha256(pw);
    if (hash === PASS_HASH) {
        sessionStorage.setItem('sp_auth_guide', hash);
        document.getElementById('loginOverlay').style.display = 'none';
    } else {
        document.getElementById('loginError').style.display = 'block';
        document.getElementById('passwordInput').value = '';
        document.getElementById('passwordInput').focus();
    }
}

// Check session on load
(async () => {
    const saved = sessionStorage.getItem('sp_auth_guide');
    if (saved && saved === PASS_HASH) {
        document.getElementById('loginOverlay').style.display = 'none';
    } else {
        document.getElementById('passwordInput').focus();
    }
})();
</script>
</body>
</html>
